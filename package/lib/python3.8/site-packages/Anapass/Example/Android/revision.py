

import ted
import sys
import getopt

def print_help() :
    print(" ")
    print("ted.revision --<option-name>=<options-value> ")
    print(" ")
    print("   <options-name>")
    print("       --dut:  dut index (default : 0)")
    print(" ")
    print(" ")
    print("   Example:")
    print("       Ex1) ted.revision  ")
    print("       Ex2) ted.revision --dut=1 ")
    print(" ")
    

def string_to_int(strValue, valueName) : 
    try :
        value=int(strValue, 0)
    except ValueError as err:
        print("ValueError : %s is not Number [%s]" % (valueName,strValue))
        sys.exit()
    return value


def main(argv) :
    
    try :
        # opts : getopt 옵션에 따라 파싱 ex) [('-i', 'myin')]
        # etc_args: getopt 옵션 이외에 입력된 일반 Argument
        # argv 첫번째 (index:0) 는 Python파일명, 두번째 (index:1) 부터  Arguments
        opts, etc_args = getopt.getopt(argv[1:], "hd:", ["help", "dut=" ])

    except getopt.GetoptError:  #�ɼ������� �ùٸ��� ���� ���
        print("ERROR :  the name of option is invalid")
        sys.exit()

    dutIdx = 0
    dutCount = ted.SysGetDutCount()

    if len(opts) > 0 :
        for opt, arg in opts :

            if opt in ("-h", "--help") :
                print_help()
                sys.exit();
   
            elif opt in ("-d", "--dut") :
                dutIdx = string_to_int(arg, "--dut")
                if (dutIdx < 0) or (dutIdx >= dutCount)  :
                    print("ERROR: The values of dutIdx is out of range. (min:0  max:%d),  dutCount=%d" % (dutCount-1, dutCount) )
                    sys.exit()
    
    print()

    revBytesList = ted.ANA670X_GetProductRevisionBytes(dutIdx)
    print()

    print("Revision Bytes, DutIdx=%d" % dutIdx)
    # ChipID 읽은 결과 출력
    for value in revBytesList :
        print(hex(value), end=' ')

    print()
    
if __name__ == "__main__" :
    main(sys.argv)

