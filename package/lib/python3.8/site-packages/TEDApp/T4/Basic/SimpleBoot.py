from TModule.Device import *
from TED.Register import ANA6705 as Reg6705


#
#  T4, 6705, Manual Power Sequence
#
print("----------------------------------------------")
print("T4, 6705, Manual Power Sequence")
print("----------------------------------------------")

#TDevice 객체 생성, T5연결하는 Device객체이다.
device = TDevice(TDevice.Type.T4)
print("Connect To " + device.GetName() )
isConnect = device.Connect()
assert isConnect 

device.SendTxtCmd("HOST_RCV	= ON");
device.SendTxtCmd("AMPCHK	= ON");
device.SendTxtCmd("GPEN		= ON");

#    구동기 Power 설정
print("Power Setting........");
device.SendTxtCmd("IOV=1.8, 1.8");

device.SendTxtCmd("VVCI=3.0");
device.SendTxtCmd("VVBAT2=3.0");
device.SendTxtCmd("VVDD2=1.8");
device.SendTxtCmd("PVDD1=ON");
device.SendTxtCmd("PVBAT1=ON");

device.SendTxtCmd("AVBAT1=2A, 1999.0, 0.0");
device.SendTxtCmd("AVDD1=500mA, 150, 0.0");
device.SendTxtCmd("AVCI=500mA, 100, 0.0");
device.SendTxtCmd("AVBAT2=500mA, 80, 0.0");
device.SendTxtCmd("AVDD2=500mA, 100, 0.0");
device.SendTxtCmd("VVDD1=1.8; VDDI Sort Start적용(Flash Memory POR 안정화)");
device.SendTxtCmd("VVBAT1=4.0; VBAT inrush 방지 Seq");
device.SendTxtCmd("DELAYMS=350; 구동기 전원 생성 delay 및 VBAT 안정화 delay");

device.SendTxtCmd("PVCI=ON");
device.SendTxtCmd("DELAYMS=10");
device.SendTxtCmd("PVDD2=ON");
device.SendTxtCmd("PVBAT2=ON");
device.SendTxtCmd("DELAYMS=50; 안정화 delay");
print("Done.");

#MIPI 설정
print("MIPI Setting........");
device.SendTxtCmd("MIPI_CLOCK	= 898, 9.0, OFF");
device.SendTxtCmd("DSI_INIT	= COMMAND,NONBURST, 4LANE, 24BPP_888, 16BPP_565 ; 601NN01 1080 * 2160");
device.SendTxtCmd("DSI_ENHSCLK	= OFF");
device.SendTxtCmd("READ_CMD_DELAY	= 15");
device.SendTxtCmd("DSI_HSLP	= HS");#//; 170306
print("Done.");

#MIPI_INIT = 1:COMMAND / VIDEO MODE,
#    2 : NONBURST / BURST MODE,
#    3 : 1LANE / 2LANE / 3LANE / 4LANE Data Enable, ..
#    , 4 : 0x000000~0x011111 (D0 - Hsync, D4 - HBporch, D8 - HFporch, D12 - HEn, D16 - PulseEvent)
#    ex) MIPI_INIT = COMMAND, BURST, 4LANE, 0x000000

#    RESETX => Reset
print("External Reset.......");
device.SendTxtCmd("EXT_CFG = EXT1, OUT");
device.SendTxtCmd("EXT1 = H");
device.SendTxtCmd("EXT1 = L");
device.SendTxtCmd("EXT1 = H");
print("Done.");

#    TED Internal Setting
#Sleep OUT,  내부 Register가  OPT에서 로딩하면서 설정된다. 
print("TED Internal Settin.........");
device.SendTxtCmd("WREG0=0x39,0x9F,0x5A,0x5A ; Level 1 key ON (UCS)"); 
device.SendTxtCmd("WREG0=0x39,0xF0,0x5A,0x5A	; Level 2 key ON (MCS)");
device.SendTxtCmd("WREG0=0x39,0xFC,0x5A,0x5A	; Level 2 Key ON, OTP COUNT Reading");
    
device.SendTxtCmd("WREG0= 0x05,0x11 ;Sleep out"); #//Sleep Out
print("Sleep-Out  ");

#Input Data Size
device.SendTxtCmd("wreg0=0x15, 0xE2, 0x01; Scaler On");
device.SendTxtCmd("WREG0=0x39, 0x2A, 0x00, 0x00, 0x02, 0x1B; Scaler Display Mode  CASET(540)");
device.SendTxtCmd("WREG0 = 0x39, 0x2B, 0x00, 0x00, 0x09, 0x5F; Scaler Display Mode  PASET(2400)");

#DSC ON
#device.SendTxtCmd("WREG0=0x07, 0x01 ; DSC ON"); //DSC ON
#device.SendTxtCmd("WREG0 =0x39, 0x9E, 0x11, 0x00, 0x00, 0x89, 0x30, 0x80, 0x09, 0x60, 0x04, 0x38, 0x00, 0x30, 0x02, 0x1C, 0x02, 0x1C, 0x02, 0x00, 0x02, 0x52, 0x00, 0x20, 0x04, 0x23, 0x00, 0x07, 0x00, 0x0F, 0x02, 0x8E, 0x02, 0x1F, 0x18, 0x00, 0x10, 0xF0, 0x03, 0x0C, 0x20, 0x00, 0x06, 0x0B, 0x0B, 0x33, 0x0E, 0x1C, 0x2A, 0x38, 0x46, 0x54, 0x62, 0x69, 0x70, 0x77, 0x79, 0x7B, 0x7D, 0x7E, 0x01, 0x02, 0x01, 0x00, 0x09, 0x40, 0x09, 0xBE, 0x19, 0xFC, 0x19, 0xFA, 0x19, 0xF8, 0x1A, 0x38, 0x1A, 0x78, 0x1A, 0xB6, 0x2A, 0xB6, 0x2A, 0xF4, 0x2A, 0xF4, 0x4B, 0x34, 0x63, 0x74"); //Write PPS
#print("DSC  ");

#Brightness ON
device.SendTxtCmd("WREG0=0x15, 0x53, 0x20	; Brightness Control ON"); #//; Brightness Control ON
device.SendTxtCmd("WREG0 = 0x39, 0x51, 0x03, 0xFF");   #//Brightness Level 설정 
print("Brightness  ");

#FPS 설정 
device.SendTxtCmd("WREG0 = 0x39, 0x60, 0x10; FQ_SEL  90Hz 구동");
print("FPS  ");

#Display On 
device.SendTxtCmd("WREG0 = 0x05, 0x29");
device.SendTxtCmd("WREG0 = 0x15, 0xB0, 0");
print("DisplayOn  ");

device.SendTxtCmd("PTRN_SET=RGBGray3H, 0, 0, 1080, 2400, 1");
device.SendTxtCmd("PTRN_SET=Write, 0");
print("Draw-RGBGray3H ");
print("....Done! ");


